# AuditLuma é¡¹ç›®ç»“æ„

## é¡¹ç›®æ¦‚è¿°
AuditLuma æ˜¯ä¸€ä¸ªé«˜çº§ä»£ç å®¡è®¡AIç³»ç»Ÿï¼ŒåŸºäºå±‚çº§RAGæ¶æ„å®ç°è‡ªåŠ¨åŒ–ä»£ç å®‰å…¨å®¡è®¡å’Œæ¼æ´æ£€æµ‹ã€‚

## å®Œæ•´ç›®å½•ç»“æ„

```
AuditLuma/
â”œâ”€â”€ auditluma/                    # æ ¸å¿ƒ Python åŒ…
â”‚   â”œâ”€â”€ agents/                    # AI ä»£ç†å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                # ä»£ç†åŸºç±»
â”‚   â”‚   â”œâ”€â”€ code_analyzer.py       # ä»£ç åˆ†æä»£ç†
â”‚   â”‚   â”œâ”€â”€ orchestrator.py        # ä»£ç†ç¼–æ’å™¨
â”‚   â”‚   â”œâ”€â”€ remediation.py         # ä¿®å¤å»ºè®®ä»£ç†
â”‚   â”‚   â””â”€â”€ security_analyst.py    # å®‰å…¨åˆ†æä»£ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ analyzers/               # åˆ†æå™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ global_context_analyzer.py
â”‚   â”‚   â”œâ”€â”€ cross_file_analyzer.py
â”‚   â”‚   â””â”€â”€ dataflow_analyzer.py
â”‚   â”‚
â”‚   â”œâ”€â”€ mcp/                     # æ¨¡å‹æ§åˆ¶å¹³é¢
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ protocol.py            # é€šä¿¡åè®®
â”‚   â”‚   â”œâ”€â”€ server.py              # MCPæœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ client.py              # MCPå®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ code.py                # ä»£ç ç›¸å…³æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ vulnerability.py       # æ¼æ´æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ cvss4.py              # CVSS 4.0æ¨¡å‹
â”‚   â”‚   â””â”€â”€ hierarchical_rag.py    # å±‚çº§RAGæ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ orchestrator/            # ç¼–æ’å™¨æ¨¡å—ï¼ˆå±‚çº§RAGæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ haystack_orchestrator.py      # ä¼ ç»ŸHaystackç¼–æ’å™¨
â”‚   â”‚   â”œâ”€â”€ haystack_ai_orchestrator.py   # Haystack-AIç¼–æ’å™¨ï¼ˆæ¨èï¼‰
â”‚   â”‚   â”œâ”€â”€ task_decomposer.py            # ä»»åŠ¡åˆ†è§£å™¨
â”‚   â”‚   â”œâ”€â”€ parallel_executor.py          # å¹¶è¡Œæ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ result_integrator.py          # ç»“æœæ•´åˆå™¨
â”‚   â”‚   â””â”€â”€ error_handling.py             # é”™è¯¯å¤„ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ parsers/                 # ä»£ç è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ code_parser.py         # é€šç”¨ä»£ç è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ python_parser.py       # Pythonè§£æå™¨
â”‚   â”‚   â”œâ”€â”€ javascript_parser.py   # JavaScriptè§£æå™¨
â”‚   â”‚   â””â”€â”€ java_parser.py         # Javaè§£æå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ rag/                     # RAGç›¸å…³æ¨¡å—ï¼ˆå±‚çº§RAGå„å±‚å®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ self_rag.py            # Self-RAGå®ç°
â”‚   â”‚   â”œâ”€â”€ txtai_retriever.py     # txtaiçŸ¥è¯†æ£€ç´¢å±‚
â”‚   â”‚   â”œâ”€â”€ r2r_enhancer.py        # R2Rä¸Šä¸‹æ–‡å¢å¼ºå±‚
â”‚   â”‚   â””â”€â”€ self_rag_validator.py  # Self-RAGéªŒè¯å±‚
â”‚   â”‚
â”‚   â”œâ”€â”€ migration/               # é…ç½®è¿ç§»
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ config_migrator.py     # é…ç½®è¿ç§»å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/               # æŠ¥å‘Šæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ report.html           # HTML æŠ¥å‘Šæ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ visualizer/              # å¯è§†åŒ–ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ graph_visualizer.py    # å›¾è¡¨å¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ report_generator.py    # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â”‚   â””â”€â”€ templates/             # å¯è§†åŒ–æ¨¡æ¿
â”‚   â”‚       â””â”€â”€ report_template.html
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ file_utils.py          # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ security_utils.py      # å®‰å…¨å·¥å…·
â”‚   â”‚   â””â”€â”€ visualization.py       # å¯è§†åŒ–å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                  # ğŸ“‹ ç»Ÿä¸€é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ orchestrator.py            # ä¸»ç¼–æ’å™¨
â”‚   â”œâ”€â”€ scanner.py                 # ä»£ç æ‰«æå™¨
â”‚   â””â”€â”€ utils.py                   # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config.yaml.example        # ä¸»é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆåŒ…å«Haystack-AIé…ç½®ï¼‰
â”‚   â”œâ”€â”€ api_config.yaml.example    # APIé…ç½®ç¤ºä¾‹
â”‚   â”œâ”€â”€ hierarchical_rag_config.yaml  # è¯¦ç»†çš„å±‚çº§RAGé…ç½®
â”‚   â””â”€â”€ backups/                   # é…ç½®å¤‡ä»½ç›®å½•
â”‚
â”œâ”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_agents.py             # æ™ºèƒ½ä½“æµ‹è¯•
â”‚   â”œâ”€â”€ test_analyzers.py          # åˆ†æå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_models.py             # æ¨¡å‹æµ‹è¯•
â”‚   â”œâ”€â”€ test_orchestrator.py       # ç¼–æ’å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_parsers.py            # è§£æå™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_rag.py                # RAGæµ‹è¯•
â”‚   â”œâ”€â”€ test_hierarchical_rag_config.py  # å±‚çº§RAGé…ç½®æµ‹è¯•
â”‚   â”œâ”€â”€ test_hierarchical_rag_models.py  # å±‚çº§RAGæ¨¡å‹æµ‹è¯•
â”‚   â””â”€â”€ test_error_handling.py     # é”™è¯¯å¤„ç†æµ‹è¯•
â”‚
â”œâ”€â”€ data/                        # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ vulnerability_db/          # æ¼æ´æ•°æ®åº“
â”‚   â”œâ”€â”€ best_practices/            # æœ€ä½³å®è·µåº“
â”‚   â”œâ”€â”€ historical_cases/          # å†å²æ¡ˆä¾‹
â”‚   â””â”€â”€ cache/                     # ç¼“å­˜ç›®å½•
â”‚
â”œâ”€â”€ lib/                         # ç¬¬ä¸‰æ–¹åº“
â”‚   â”œâ”€â”€ bindings/                 # è¯­è¨€ç»‘å®š
â”‚   â”‚   â””â”€â”€ utils.js
â”‚   â”œâ”€â”€ tom-select/               # é€‰æ‹©æ¡†ç»„ä»¶
â”‚   â””â”€â”€ vis-9.1.2/                # å¯è§†åŒ–åº“
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ api.md                     # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md            # æ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ configuration.md           # é…ç½®æ–‡æ¡£
â”‚   â””â”€â”€ development.md             # å¼€å‘æ–‡æ¡£
â”‚
â”œâ”€â”€ é¡¹ç›®ç»“æ„.md                       # é¡¹ç›®ç»“æ„è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ main.py                      # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–ï¼ˆåŒ…å«haystack-aiï¼‰
â”œâ”€â”€ glconfig.py                  # å…¨å±€é…ç½®
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â””â”€â”€ LICENSE                      # è®¸å¯è¯æ–‡ä»¶
```

## ä¸»è¦ç»„ä»¶è¯´æ˜

### ğŸš€ å±‚çº§RAGæ¶æ„æ ¸å¿ƒ
- **`auditluma/orchestrator/`**: ç¼–æ’å™¨æ¨¡å—ï¼Œå±‚çº§RAGæ¶æ„çš„æ ¸å¿ƒ
  - `haystack_ai_orchestrator.py`: â­ åŸºäºHaystack-AIçš„ä¸»ç¼–æ’å™¨ï¼ˆæ¨èä½¿ç”¨ï¼‰
  - `task_decomposer.py`: ä»»åŠ¡åˆ†è§£å™¨ï¼Œå°†å®¡è®¡ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡
  - `parallel_executor.py`: å¹¶è¡Œæ‰§è¡Œå™¨ï¼Œé«˜æ•ˆæ‰§è¡Œå¤šä¸ªä»»åŠ¡
  - `result_integrator.py`: ç»“æœæ•´åˆå™¨ï¼Œæ™ºèƒ½åˆå¹¶å’Œå»é‡ç»“æœ

### ğŸ—ï¸ å±‚çº§RAGå„å±‚å®ç°
- **`auditluma/rag/`**: RAGç›¸å…³æ¨¡å—
  - `txtai_retriever.py`: txtaiçŸ¥è¯†æ£€ç´¢å±‚ï¼Œå®æ—¶æ£€ç´¢CVEå’Œæœ€ä½³å®è·µ
  - `r2r_enhancer.py`: R2Rä¸Šä¸‹æ–‡å¢å¼ºå±‚ï¼Œæ·±åº¦ä»£ç ä¸Šä¸‹æ–‡åˆ†æ
  - `self_rag_validator.py`: Self-RAGéªŒè¯å±‚ï¼Œæ™ºèƒ½éªŒè¯å’Œå‡é˜³æ€§è¿‡æ»¤
  - `self_rag.py`: ä¼ ç»ŸSelf-RAGå®ç°

### ğŸ¤– AIä»£ç†ç³»ç»Ÿ
- **`auditluma/agents/`**: AIä»£ç†å®ç°
  - `base.py`: ä»£ç†åŸºç±»
  - `code_analyzer.py`: ä»£ç åˆ†æä»£ç†
  - `security_analyst.py`: å®‰å…¨åˆ†æä»£ç†
  - `remediation.py`: ä¿®å¤å»ºè®®ä»£ç†
  - `orchestrator.py`: ä»£ç†ç¼–æ’å™¨

### ğŸ“Š æ•°æ®æ¨¡å‹å’Œåˆ†æå™¨
- **`auditluma/models/`**: æ•°æ®æ¨¡å‹å®šä¹‰
  - `code.py`: ä»£ç ç›¸å…³æ¨¡å‹
  - `vulnerability.py`: æ¼æ´æ¨¡å‹
  - `cvss4.py`: CVSS 4.0è¯„åˆ†æ¨¡å‹
  - `hierarchical_rag.py`: å±‚çº§RAGæ¨¡å‹
- **`auditluma/analyzers/`**: é«˜çº§åˆ†æå™¨
  - `global_context_analyzer.py`: å…¨å±€ä¸Šä¸‹æ–‡åˆ†æ
  - `cross_file_analyzer.py`: è·¨æ–‡ä»¶åˆ†æ
  - `dataflow_analyzer.py`: æ•°æ®æµåˆ†æ

### âš™ï¸ é…ç½®å’Œå·¥å…·
- **`auditluma/config.py`**: ğŸ“‹ ç»Ÿä¸€é…ç½®ç®¡ç†ç³»ç»Ÿ
- **`config/`**: é…ç½®æ–‡ä»¶ç›®å½•
  - `config.yaml.example`: ä¸»é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆåŒ…å«Haystack-AIé…ç½®ï¼‰
  - `hierarchical_rag_config.yaml`: è¯¦ç»†çš„å±‚çº§RAGé…ç½®
- **`auditluma/parsers/`**: ä»£ç è§£æå™¨ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€
- **`auditluma/utils/`**: å·¥å…·å‡½æ•°å’Œå®ç”¨ç¨‹åº

### ğŸ“– æ–‡æ¡£å’Œæ¼”ç¤º
- **`Haystack-AIé›†æˆæŒ‡å—.md`**: ğŸ“– å®Œæ•´çš„Haystack-AIé›†æˆå’Œä½¿ç”¨æŒ‡å—
- **`demo_haystack_ai_orchestrator.py`**: ğŸš€ Haystack-AIæ¼”ç¤ºè„šæœ¬
- **`validate_haystack_config.py`**: é…ç½®éªŒè¯è„šæœ¬

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- OpenAI APIå¯†é’¥ï¼ˆç”¨äºHaystack-AIï¼‰
- ä¾èµ–ç®¡ç†: `requirements.txt`ï¼ˆåŒ…å«haystack-aiï¼‰

### å¿«é€Ÿå¼€å§‹

1. å®‰è£…ä¾èµ–:
   ```bash
   pip install -r requirements.txt
   ```

2. é…ç½®ç¯å¢ƒå˜é‡:
   ```bash
   export OPENAI_API_KEY="your-openai-api-key"
   ```

3. éªŒè¯Haystack-AIé…ç½®:
   ```bash
   python validate_haystack_config.py
   ```

4. è¿è¡ŒHaystack-AIæ¼”ç¤º:
   ```bash
   python demo_haystack_ai_orchestrator.py
   ```

5. è¿è¡Œä¸»ç¨‹åº:
   ```bash
   python main.py -d /path/to/target/code -o ./reports
   ```

### ğŸš€ ä½¿ç”¨Haystack-AIå±‚çº§RAGæ¶æ„

```python
from auditluma.orchestrator.haystack_ai_orchestrator import HaystackAIOrchestrator
from auditluma.models.code import SourceFile

# åˆå§‹åŒ–ç¼–æ’å™¨ï¼ˆè‡ªåŠ¨ä»config.yamlè¯»å–é…ç½®ï¼‰
orchestrator = HaystackAIOrchestrator()

# æ‰§è¡Œå®¡è®¡
result = await orchestrator.orchestrate_audit(source_files)
```

### é…ç½®è¯´æ˜

åœ¨ `config.yaml` ä¸­é…ç½®å±‚çº§RAGï¼š

```yaml
hierarchical_rag:
  enabled: true
  haystack:
    enabled: true
    use_haystack_ai: true
    model_name: "gpt-3.5-turbo"
    max_workers: 10
```

è¯¦ç»†é…ç½®è¯·å‚è€ƒï¼š`Haystack-AIé›†æˆæŒ‡å—.md`

## è´¡çŒ®æŒ‡å—

1. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
2. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
3. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
4. åˆ›å»º Pull Request

## è®¸å¯è¯
[MIT]
